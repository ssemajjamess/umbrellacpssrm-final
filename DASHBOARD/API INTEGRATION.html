<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Integration - Umbrella Claims & Property Solutions</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }

        .sidebar-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .company-logo {
            max-width: 120px;
            height: auto;
        }

        .company-name {
            font-size: 0.9rem;
            color: #1e3c72;
            font-weight: bold;
            margin-top: 10px;
        }

        .user-info {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }

        .nav-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: #333;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .nav-link:hover {
            background: #1e3c72;
            color: white;
        }

        .nav-link.active {
            background: #1e3c72;
            color: white;
        }

        .nav-link i {
            margin-right: 10px;
            width: 20px;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: bold;
            color: white;
            margin: 0;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: #1e3c72;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .user-info {
            color: white;
        }

        .integration-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .integration-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .integration-title {
            font-size: 2rem;
            font-weight: bold;
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .integration-subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .status-live {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .endpoint-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #1e3c72;
        }

        .endpoint-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #1e3c72;
            margin-bottom: 15px;
        }

        .endpoint-url {
            background: #e9ecef;
            padding: 12px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .copy-btn {
            background: #1e3c72;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .copy-btn:hover {
            background: #2a5298;
        }

        .endpoint-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .feature-list {
            list-style: none;
            padding: 0;
        }

        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
        }

        .feature-list li:last-child {
            border-bottom: none;
        }

        .feature-list li i {
            color: #28a745;
            margin-right: 10px;
            width: 20px;
        }

        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #e9ecef;
        }

        .test-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #1e3c72;
            margin-bottom: 15px;
        }

        .test-form {
            display: grid;
            gap: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .form-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9rem;
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #28a745;
            color: white;
        }

        .btn-primary:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
            transform: translateY(-2px);
        }

        .response-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .response-title {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .response-success {
            color: #155724;
            background: #d4edda;
            border: 1px solid #c3e6cb;
        }

        .response-error {
            color: #721c24;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -100%;
                top: 0;
                height: 100vh;
                z-index: 1000;
                transition: left 0.3s ease;
            }

            .sidebar.active {
                left: 0;
            }

            .main-content {
                margin-left: 0;
                padding: 10px;
            }

            .mobile-menu-btn {
                display: block;
            }

            .top-bar {
                flex-direction: column;
                gap: 15px;
            }

            .integration-title {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <img src="../LOGOS/PNG File-01.png" alt="Umbrella Claims Logo" class="company-logo">
                <div class="company-name">Umbrella Claims & Property Solutions</div>
                <div class="user-info" id="userInfo">Loading...</div>
            </div>

            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="DASHBOARD.html" class="nav-link">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="customers.html" class="nav-link">
                        <i class="fas fa-users"></i>
                        Customers
                    </a>
                </li>
                <li class="nav-item">
                    <a href="CLAIMS MANAGEMENT.html" class="nav-link">
                        <i class="fas fa-file-contract"></i>
                        Claims Management
                    </a>
                </li>
                <li class="nav-item">
                    <a href="DOCUMENT MANAGEMENT.html" class="nav-link">
                        <i class="fas fa-folder-open"></i>
                        Documents
                    </a>
                </li>
                <li class="nav-item">
                    <a href="CALENDAR.html" class="nav-link">
                        <i class="fas fa-calendar-alt"></i>
                        Calendar
                    </a>
                </li>
                <li class="nav-item">
                    <a href="INVOICE MANAGEMENT.html" class="nav-link">
                        <i class="fas fa-file-invoice-dollar"></i>
                        Invoices
                    </a>
                </li>
                <li class="nav-item">
                    <a href="API INTEGRATION.html" class="nav-link active">
                        <i class="fas fa-plug"></i>
                        API Integration
                    </a>
                </li>
                <li class="nav-item">
                    <a href="NEW LEAD.html" class="nav-link">
                        <i class="fas fa-plus-circle"></i>
                        New Lead
                    </a>
                </li>
                <li class="nav-item">
                    <a href="CREATE A TASK.html" class="nav-link">
                        <i class="fas fa-tasks"></i>
                        Create Task
                    </a>
                </li>
                <li class="nav-item">
                    <a href="REMINDER.html" class="nav-link">
                        <i class="fas fa-bell"></i>
                        Reminders
                    </a>
                </li>
                <li class="nav-item">
                    <a href="../ACCOUNT SETTINGS/ACCOUNT SETTINGS.html" class="nav-link">
                        <i class="fas fa-cog"></i>
                        Account Settings
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                        Sign Out
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="top-bar">
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="page-title">API Integration</h1>
                <div class="user-menu">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div class="user-info">
                        <div id="userDisplayName">User</div>
                        <div id="userEmail">user@example.com</div>
                    </div>
                </div>
            </div>

            <div class="integration-container">
                <div class="integration-header">
                    <h2 class="integration-title">🎉 Your CRM Integration is Complete!</h2>
                    <p class="integration-subtitle">I've successfully created a complete system that automatically sends PDF contracts from your insurance portal directly to your CRM and creates customer records.</p>
                    <div class="status-badge status-live">
                        <i class="fas fa-check-circle"></i>
                        Integration Status: LIVE
                    </div>
                </div>

                <!-- Main Integration Endpoint -->
                <div class="endpoint-section">
                    <h3 class="endpoint-title">1. Main Integration Endpoint</h3>
                    <div class="endpoint-url">
                        <span>POST https://crm.roofsbyumbrella.com/api/crm/receive-contract</span>
                        <button class="copy-btn" onclick="copyToClipboard('https://crm.roofsbyumbrella.com/api/crm/receive-contract')">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                    <p class="endpoint-description">This endpoint accepts PDF file uploads with customer data and automatically creates customer records in your CRM database.</p>
                    <ul class="feature-list">
                        <li><i class="fas fa-check"></i> Accepts PDF file uploads with customer data</li>
                        <li><i class="fas fa-check"></i> Automatically creates customer records in your database</li>
                        <li><i class="fas fa-check"></i> Saves PDF contracts to your file system</li>
                        <li><i class="fas fa-check"></i> Returns customer ID and success confirmation</li>
                    </ul>
                </div>

                <!-- Alternative JSON Endpoint -->
                <div class="endpoint-section">
                    <h3 class="endpoint-title">2. Alternative JSON Endpoint</h3>
                    <div class="endpoint-url">
                        <span>POST https://crm.roofsbyumbrella.com/api/crm/receive-contract-json</span>
                        <button class="copy-btn" onclick="copyToClipboard('https://crm.roofsbyumbrella.com/api/crm/receive-contract-json')">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                    <p class="endpoint-description">For server-side integrations using base64 PDF data. Same functionality as above but with JSON payload.</p>
                    <ul class="feature-list">
                        <li><i class="fas fa-check"></i> For server-side integrations using base64 PDF data</li>
                        <li><i class="fas fa-check"></i> Same functionality as above but with JSON payload</li>
                    </ul>
                </div>

                <!-- Customer Management -->
                <div class="endpoint-section">
                    <h3 class="endpoint-title">3. Customer Management</h3>
                    <div class="endpoint-url">
                        <span>GET https://crm.roofsbyumbrella.com/api/crm/customers</span>
                        <button class="copy-btn" onclick="copyToClipboard('https://crm.roofsbyumbrella.com/api/crm/customers')">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                    <p class="endpoint-description">Retrieve all customers from your CRM database.</p>
                    
                    <div class="endpoint-url" style="margin-top: 10px;">
                        <span>GET https://crm.roofsbyumbrella.com/api/crm/customers/:id</span>
                        <button class="copy-btn" onclick="copyToClipboard('https://crm.roofsbyumbrella.com/api/crm/customers/:id')">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                    <p class="endpoint-description">Retrieve a specific customer by ID.</p>
                </div>

                <!-- Testing Section -->
                <div class="test-section">
                    <h3 class="test-title">Testing Your Integration</h3>
                    <p>You can test by completing a contract in your insurance portal - it will now automatically appear in your CRM system and the PDF will be saved.</p>
                    
                    <div class="test-form">
                        <div class="form-group">
                            <label class="form-label">Test Customer Data (JSON)</label>
                            <textarea class="form-textarea" id="testCustomerData" placeholder="Enter customer data in JSON format...">{
  "name": "John Doe",
  "email": "john.doe@example.com",
  "phone": "555-123-4567",
  "address": "123 Main St, Greenville, SC 29611",
  "insuranceCompany": "ALLSTATE",
  "claimNumber": "CLM-2024-001",
  "policyNumber": "POL-123456"
}</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Test PDF File</label>
                            <input type="file" class="form-input" id="testPdfFile" accept=".pdf">
                        </div>
                        
                        <div style="display: flex; gap: 15px;">
                            <button class="btn btn-primary" onclick="testMainEndpoint()">
                                <i class="fas fa-play"></i>
                                Test Main Endpoint
                            </button>
                            <button class="btn btn-info" onclick="testJsonEndpoint()">
                                <i class="fas fa-code"></i>
                                Test JSON Endpoint
                            </button>
                            <button class="btn btn-secondary" onclick="testGetCustomers()">
                                <i class="fas fa-users"></i>
                                Test Get Customers
                            </button>
                        </div>
                    </div>
                    
                    <div class="response-section" id="responseSection">
                        <div class="response-title" id="responseTitle">Response</div>
                        <div id="responseContent"></div>
                    </div>
                </div>

                <!-- Integration Status -->
                <div class="endpoint-section">
                    <h3 class="endpoint-title">Integration Status</h3>
                    <p class="endpoint-description">The integration is live and ready to use! Your insurance portal and CRM are now fully connected with automatic customer and contract synchronization.</p>
                    <ul class="feature-list">
                        <li><i class="fas fa-check"></i> Sends signed contracts to your CRM when customers complete the process</li>
                        <li><i class="fas fa-check"></i> Creates customer records with all the data (name, address, phone, insurance info, etc.)</li>
                        <li><i class="fas fa-check"></i> Saves PDF files in organized folders</li>
                        <li><i class="fas fa-check"></i> Provides success/failure feedback</li>
                    </ul>
                </div>
            </div>
        </main>
    </div>

    <script src="crm-data.js"></script>
    <script src="../API/crm-api.js"></script>
    <script>
        // Initialize page
        function initializePage() {
            // Check authentication
            const isLoggedIn = localStorage.getItem('userLoggedIn');
            if (isLoggedIn !== 'true') {
                window.location.href = '../index.html';
                return;
            }

            // Set user information
            const userEmail = localStorage.getItem('userEmail') || 'james@roofsbyumbrella.com';
            const userName = localStorage.getItem('userName') || 'James Causey';
            const userRole = localStorage.getItem('userRole') || 'Owner';
            
            // Set current user in CRM
            const currentUser = crm.getUsers().find(u => u.email === userEmail) || crm.getUsers()[0];
            crm.setCurrentUser(currentUser);
            
            document.getElementById('userDisplayName').textContent = currentUser.name;
            document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
            document.getElementById('userInfo').textContent = currentUser.name;

            // Initialize mobile menu
            initializeMobileMenu();
        }

        // Mobile menu functionality
        function initializeMobileMenu() {
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const sidebar = document.getElementById('sidebar');
            
            if (mobileMenuBtn && sidebar) {
                mobileMenuBtn.addEventListener('click', function() {
                    sidebar.classList.toggle('active');
                });

                // Close menu when clicking outside
                document.addEventListener('click', function(e) {
                    if (!sidebar.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                        sidebar.classList.remove('active');
                    }
                });
            }
        }

        // Copy to clipboard function
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                crm.showNotification('URL copied to clipboard!', 'success');
            }).catch(function(err) {
                console.error('Could not copy text: ', err);
                crm.showNotification('Failed to copy URL', 'error');
            });
        }

        // Test main endpoint
        async function testMainEndpoint() {
            const customerData = JSON.parse(document.getElementById('testCustomerData').value);
            const pdfFile = document.getElementById('testPdfFile').files[0];
            
            if (!pdfFile) {
                crm.showNotification('Please select a PDF file', 'error');
                return;
            }

            try {
                const crmApi = new CRMAPI();
                const result = await crmApi.receiveContract(pdfFile, customerData);
                
                showResponse(result.success ? 'success' : 'error', result);
            } catch (error) {
                showResponse('error', { error: error.message });
            }
        }

        // Test JSON endpoint
        async function testJsonEndpoint() {
            const customerData = JSON.parse(document.getElementById('testCustomerData').value);
            const pdfFile = document.getElementById('testPdfFile').files[0];
            
            if (!pdfFile) {
                crm.showNotification('Please select a PDF file', 'error');
                return;
            }

            try {
                // Convert file to base64
                const base64 = await fileToBase64(pdfFile);
                
                const contractData = {
                    customerData: customerData,
                    pdfBase64: base64
                };

                const crmApi = new CRMAPI();
                const result = await crmApi.receiveContractJSON(contractData);
                
                showResponse(result.success ? 'success' : 'error', result);
            } catch (error) {
                showResponse('error', { error: error.message });
            }
        }

        // Test get customers
        async function testGetCustomers() {
            try {
                const crmApi = new CRMAPI();
                const result = await crmApi.getCustomers();
                
                showResponse(result.success ? 'success' : 'error', result);
            } catch (error) {
                showResponse('error', { error: error.message });
            }
        }

        // Convert file to base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = error => reject(error);
            });
        }

        // Show response
        function showResponse(type, data) {
            const responseSection = document.getElementById('responseSection');
            const responseTitle = document.getElementById('responseTitle');
            const responseContent = document.getElementById('responseContent');
            
            responseSection.style.display = 'block';
            responseSection.className = `response-section response-${type}`;
            responseTitle.textContent = type === 'success' ? 'Success Response' : 'Error Response';
            responseContent.textContent = JSON.stringify(data, null, 2);
        }

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', function() {
            if (confirm('Are you sure you want to sign out?')) {
                localStorage.removeItem('userLoggedIn');
                localStorage.removeItem('userEmail');
                localStorage.removeItem('userName');
                localStorage.removeItem('userRole');
                window.location.href = '../index.html';
            }
        });

        // Initialize page
        initializePage();
    </script>
</body>
</html> 